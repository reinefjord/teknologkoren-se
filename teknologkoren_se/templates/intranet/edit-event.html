{% extends "intranet/layout.html" %}

{% from "macros.html" import img, text_field, event_article %}

{% set title = "Edit event" %}

{% block head %}
{{ super() }}
<link href="https://cdn.jsdelivr.net/simplemde/latest/simplemde.min.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/flatpickr/2.6.1/flatpickr.min.css" rel="stylesheet">
{% endblock %}

{% block body %}
<section class="boxed constrain-width">
  {% if event %}
  <h2>Preview</h2>
  {{ event_article(event, overview=True) }}
  {% endif %}

  <h2>Edit event</h2>
  <form method="POST" enctype="multipart/form-data">
    {{ form.csrf_token }}

    {{ text_field(form.title) }}

    <div class="field">
      {{ form.content }}
    </div>

    {{ text_field(form.start_time, placeholder='YYYY-MM-DD hh:mm') }}

    {{ text_field(form.location) }}


    <div class="field">
      <p>Upload new image:</p>
      {{ form.upload }}
    </div>

    <div class="field">
      {{ form.published }}
      {{ form.published.label }}
    </div>

    <div class="field">
      <input type=submit value="Submit">
    </div>
  </form>
  {% if event %}
  <p>
  <a id="remove" href="{{ url_for('.remove_event', event_id=event.id, slug=event.slug) }}">Remove</a>
  </p>
  {% endif %}
</section>

<script src="https://cdn.jsdelivr.net/simplemde/latest/simplemde.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/flatpickr/2.6.1/flatpickr.min.js"></script>

<script>
flatpickr("#start_time", {
  enableTime: true,
  time_24hr: true,
  locale: {
    firstDayOfWeek: 1
  }
});
</script>

<script>
var simplemde = new SimpleMDE({
  element: document.getElementById("content"),
  spellChecker: false,
});
</script>

{% if event %}
<script>
document.getElementById("remove").addEventListener("click", function (event) {
  if (!confirm('This will delete event "{{ event.title }}"\nAre you sure you want to do that?')) {
    event.preventDefault();
  }
}, false)
</script>
{% endif %}

{% endblock %}
