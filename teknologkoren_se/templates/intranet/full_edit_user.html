{% extends "intranet/layout.html" %}

{% from "macros.html" import text_field %}

{% if current_user.id == user.id %}
{% set active_page = "profile" %}
{% else %}
{% set active_page = "members" %}
{% endif %}

{% set title = "Intran√§t" %}

{% block body %}
<div class="boxed constrain-width">
  <h2>{{ user.first_name }} {{ user.last_name }}</h2>
  <form method="POST" enctype="multipart/form-data">
    {{ form.csrf_token }}

    {{ text_field(form.first_name) }}

    {{ text_field(form.last_name) }}

    {{ text_field(form.email) }}

    {{ text_field(form.phone) }}

    <fieldset class="tag-set">
      {{ form.tags.csrf_token }}

      <legend>Tags</legend>

      <input type="text" id="tag-filter" placeholder="Filter">

      <div class="tags">
      {% for field in form.tags if field.name != "tags-csrf_token" %}
      <div class="field">
        {{ field }}
        {{ field.label }}
      </div>
      {% endfor %}
      </div>
    </fieldset>

    <div class="field">
      <input type=submit value="Submit">
    </div>

    <a href="{{ url_for('.profile', id=user.id) }}">Cancel</a>
  </form>
</div>

<script>
var filter = document.getElementById("tag-filter");

filter.addEventListener("input", function ()
    {
      var re = new RegExp(filter.value, "i");

      var tags = document.getElementsByClassName("tags")[0].getElementsByClassName("field");

      for (var i = 0; i < tags.length; i++) {
        var label = tags[i].getElementsByTagName("label")[0];
        if (re.test(label.innerHTML)) {
          tags[i].style.display = "block";
        } else {
          tags[i].style.display = "none";
        }
      }
    })
</script>
{%- endblock %}
